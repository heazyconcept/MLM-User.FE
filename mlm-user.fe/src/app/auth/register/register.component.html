<div class="min-h-screen w-full flex items-center justify-center p-4 bg-linear-to-br from-slate-50 via-white to-slate-100" style="background-image: radial-gradient(circle at 20% 80%, rgba(73, 163, 33, 0.03) 0%, transparent 50%), radial-gradient(circle at 80% 20%, rgba(73, 163, 33, 0.03) 0%, transparent 50%)">
    <div class="w-full max-w-2xl">
        <!-- Progress Bar -->
        <div class="mb-10">
            <div class="flex items-center justify-between mb-4 px-2">
                @for (step of [1, 2, 3]; track step) {
                    <div class="flex flex-col items-center gap-4 relative z-10">
                        <div [class]="currentStep() >= step ? 'bg-mlm-primary text-white' : 'bg-white text-slate-400 border border-slate-300'"
                             class="w-9 h-9 rounded-full flex items-center justify-center font-semibold text-sm transition-all duration-300">
                            @if (currentStep() > step) {
                                <i class="pi pi-check text-sm"></i>
                            } @else {
                                {{ step }}
                            }
                        </div>
                        <span class="text-xs font-semibold uppercase tracking-wide transition-colors duration-300"
                              [class]="currentStep() >= step ? 'text-slate-700' : 'text-slate-400'">
                            {{ step === 1 ? 'Personal' : step === 2 ? 'Security' : 'Membership' }}
                        </span>
                    </div>
                }
            </div>
            <!-- Connector Line -->
            <div class="relative -mt-[42px] px-12 h-0.5 w-full bg-slate-200 rounded-full">
                <div class="absolute h-full bg-mlm-primary transition-all duration-300 ease-out rounded-full"
                     [style.width]="((currentStep() - 1) / (totalSteps() - 1) * 100) + '%'">
                </div>
            </div>
        </div>

        <!-- Form Card -->
        <div class="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="p-8 sm:p-10">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-semibold text-slate-800 tracking-tight mb-2">
                        {{ currentStep() === 1 ? 'Join the Community' : currentStep() === 2 ? 'Secure Your Account' : 'Choose Your Path' }}
                    </h1>
                    <p class="text-slate-500 text-sm">
                        {{ currentStep() === 1 ? 'Start your journey with us today' : currentStep() === 2 ? 'Set up your credentials' : 'Select a package to get started' }}
                    </p>
                </div>

                <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">
                    <!-- Step 1: Personal Info -->
                    @if (currentStep() === 1) {
                        <div class="space-y-4 animate-step-in">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <app-auth-input
                                    label="First Name"
                                    placeholder="Enter first name"
                                    icon="pi-user"
                                    formControlName="firstName"
                                    [required]="true"
                                    [error]="registerForm.get('firstName')?.invalid && registerForm.get('firstName')?.touched ? 'First name is required' : null">
                                </app-auth-input>
                                <app-auth-input
                                    label="Last Name"
                                    placeholder="Enter last name"
                                    icon="pi-user"
                                    formControlName="lastName"
                                    [required]="true"
                                    [error]="registerForm.get('lastName')?.invalid && registerForm.get('lastName')?.touched ? 'Last name is required' : null">
                                </app-auth-input>
                            </div>
                            <app-auth-input
                                label="Email Address"
                                type="email"
                                placeholder="name@example.com"
                                icon="pi-envelope"
                                formControlName="email"
                                [required]="true"
                                [error]="registerForm.get('email')?.invalid && registerForm.get('email')?.touched ? 'Valid email is required' : null">
                            </app-auth-input>
                            <app-auth-input
                                label="Phone Number"
                                placeholder="+234 ..."
                                icon="pi-phone"
                                formControlName="phoneNumber"
                                [required]="true"
                                [error]="registerForm.get('phoneNumber')?.invalid && registerForm.get('phoneNumber')?.touched ? 'Phone number is required' : null">
                            </app-auth-input>
                        </div>
                    }

                    <!-- Step 2: Account Security -->
                    @if (currentStep() === 2) {
                        <div class="space-y-4 animate-step-in">
                            <app-auth-input
                                label="Password"
                                type="password"
                                placeholder="••••••••"
                                icon="pi-lock"
                                formControlName="password"
                                [required]="true"
                                [error]="registerForm.get('password')?.invalid && registerForm.get('password')?.touched ? 'Min 8 characters required' : null">
                            </app-auth-input>
                            <app-auth-input
                                label="Confirm Password"
                                type="password"
                                placeholder="••••••••"
                                icon="pi-lock-open"
                                formControlName="confirmPassword"
                                [required]="true"
                                [error]="registerForm.get('confirmPassword')?.touched && registerForm.hasError('passwordMismatch') ? 'Passwords do not match' : null">
                            </app-auth-input>
                            <app-auth-input
                                label="Sponsor Username"
                                placeholder="e.g. john_doe"
                                icon="pi-id-card"
                                formControlName="sponsorUsername">
                            </app-auth-input>
                        </div>
                    }

                    <!-- Step 3: Membership -->
                    @if (currentStep() === 3) {
                        <div class="space-y-6 animate-step-in">
                            <div>
                                <label class="block text-sm font-semibold text-slate-700 mb-2">Select Package</label>
                                <p-select 
                                    [options]="packages" 
                                    formControlName="package" 
                                    optionLabel="label" 
                                    placeholder="Choose your membership"
                                    styleClass="w-full !rounded-xl !border-slate-400">
                                </p-select>
                                @if (registerForm.get('package')?.invalid && registerForm.get('package')?.touched) {
                                    <span class="text-xs font-medium text-mlm-error mt-1.5 block">Please select a package</span>
                                }
                            </div>

                            <div class="bg-slate-50 rounded-xl p-4 border border-slate-200 flex items-start gap-3 transition-all duration-200 hover:border-mlm-primary/30">
                                <p-checkbox formControlName="acceptTerms" [binary]="true"></p-checkbox>
                                <label class="text-sm text-slate-600 leading-relaxed">
                                    I agree to the <a href="#" class="text-mlm-primary font-semibold hover:underline">Terms & Conditions</a> and understand the platform rules.
                                </label>
                            </div>
                        </div>
                    }

                    <!-- Action Buttons -->
                    <div class="mt-10 flex items-center justify-between gap-4">
                        @if (currentStep() > 1) {
                            <button type="button" 
                                    (click)="prevStep()"
                                    class="px-5 py-2.5 rounded-xl text-slate-600 font-semibold hover:bg-slate-100 transition-all duration-200 flex items-center gap-2 text-sm">
                                <i class="pi pi-arrow-left text-xs"></i>
                                Back
                            </button>
                        } @else {
                            <a routerLink="/auth/login" class="text-slate-500 font-semibold hover:text-mlm-primary transition-colors duration-200 text-sm">
                                Already have an account?
                            </a>
                        }

                        @if (currentStep() < totalSteps()) {
                            <button type="button" 
                                    (click)="nextStep()"
                                    [disabled]="!isStepValid(currentStep())"
                                    class="px-6 py-2.5 bg-mlm-primary text-white rounded-xl font-semibold hover:bg-mlm-primary/90 transition-all duration-200 flex items-center gap-2 text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                                Next Step
                                <i class="pi pi-arrow-right text-xs"></i>
                            </button>
                        } @else {
                            <button type="submit" 
                                    [disabled]="!registerForm.valid || isLoading()"
                                    class="px-6 py-2.5 bg-mlm-primary text-white rounded-xl font-semibold hover:bg-mlm-primary/90 transition-all duration-200 flex items-center gap-2 text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                                Create Account
                                @if (isLoading()) {
                                    <i class="pi pi-spin pi-spinner text-xs"></i>
                                } @else {
                                    <i class="pi pi-check text-xs"></i>
                                }
                            </button>
                        }
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
