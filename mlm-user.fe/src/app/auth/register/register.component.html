<div class="min-h-screen w-full flex items-center justify-center px-4 py-8 bg-mlm-background">
    <div class="w-full max-w-2xl">
        <!-- Progress Bar -->
        <div class="mb-10">
            <div class="flex items-center justify-between mb-4 px-1 sm:px-2">
                @for (step of [1, 2, 3]; track step) {
                    <div class="flex flex-col items-center gap-2 sm:gap-3 relative z-10">
                        <div
                            [class]="currentStep() >= step ? 'bg-mlm-primary text-white shadow-sm' : 'bg-white text-mlm-warm-400 border border-mlm-warm-200'"
                            class="w-8 h-8 sm:w-9 sm:h-9 rounded-full flex items-center justify-center font-semibold text-xs sm:text-sm transition-all duration-300">
                            {{ step }}
                        </div>
                        <span
                            class="text-[10px] sm:text-xs font-medium tracking-wide uppercase transition-colors duration-300"
                            [class]="currentStep() >= step ? 'text-mlm-warm-800' : 'text-mlm-warm-400'">
                            {{ step === 1 ? 'Personal' : step === 2 ? 'Security' : 'Membership' }}
                        </span>
                    </div>
                }
            </div>
            <!-- Connector Line -->
            <div class="relative -mt-6 sm:-mt-[38px] px-10 sm:px-12 h-px w-full bg-mlm-warm-200 rounded-full">
                <div
                    class="absolute h-full bg-mlm-primary transition-all duration-300 ease-out rounded-full"
                     [style.width]="((currentStep() - 1) / (totalSteps() - 1) * 100) + '%'">
                </div>
            </div>
        </div>

        <!-- Form Card -->
        <div class="bg-white rounded-2xl shadow-sm border border-mlm-warm-200 overflow-hidden">
            <div class="p-6 sm:p-8 lg:p-10">
                <div class="text-center mb-8">
                    <h1 class="text-2xl sm:text-3xl font-semibold text-mlm-warm-900 tracking-tight mb-2">
                        {{ currentStep() === 1 ? 'Create your account' : currentStep() === 2 ? 'Secure your access' : 'Choose your membership' }}
                    </h1>
                    <p class="text-mlm-warm-600 text-sm max-w-md mx-auto">
                        {{ currentStep() === 1 ? 'A few details to get you started. No clutter, just what we need.' : currentStep() === 2 ? 'Set a strong password and confirm your sponsor so your account stays protected.' : 'Pick the membership that matches where you are today. You can always grow from here.' }}
                    </p>
                </div>

                <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">
                    <!-- Step 1: Personal Info -->
                    @if (currentStep() === 1) {
                        <div class="space-y-5 animate-step-in">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <app-auth-input
                                    label="First Name"
                                    placeholder="Enter first name"
                                    formControlName="firstName"
                                    [required]="true"
                                    [error]="registerForm.get('firstName')?.invalid && registerForm.get('firstName')?.touched ? 'First name is required' : null">
                                </app-auth-input>
                                <app-auth-input
                                    label="Last Name"
                                    placeholder="Enter last name"
                                    formControlName="lastName"
                                    [required]="true"
                                    [error]="registerForm.get('lastName')?.invalid && registerForm.get('lastName')?.touched ? 'Last name is required' : null">
                                </app-auth-input>
                            </div>
                            <app-auth-input
                                label="Email Address"
                                type="email"
                                placeholder="name@example.com"
                                formControlName="email"
                                [required]="true"
                                [error]="registerForm.get('email')?.invalid && registerForm.get('email')?.touched ? 'Valid email is required' : null">
                            </app-auth-input>
                            <app-auth-input
                                label="Phone Number"
                                placeholder="+234 ..."
                                formControlName="phoneNumber"
                                [required]="true"
                                [error]="registerForm.get('phoneNumber')?.invalid && registerForm.get('phoneNumber')?.touched ? 'Phone number is required' : null">
                            </app-auth-input>
                        </div>
                    }

                    <!-- Step 2: Account Security -->
                    @if (currentStep() === 2) {
                        <div class="space-y-6 animate-step-in">
                            <div class="space-y-4">
                                <app-auth-input
                                    label="Password"
                                    type="password"
                                    placeholder="••••••••"
                                    formControlName="password"
                                    [required]="true"
                                    [error]="registerForm.get('password')?.invalid && registerForm.get('password')?.touched ? 'Min 8 characters required' : null">
                                </app-auth-input>
                                <app-auth-input
                                    label="Confirm Password"
                                    type="password"
                                    placeholder="••••••••"
                                    formControlName="confirmPassword"
                                    [required]="true"
                                    [error]="registerForm.get('confirmPassword')?.touched && registerForm.hasError('passwordMismatch') ? 'Passwords do not match' : null">
                                </app-auth-input>
                                <p class="text-xs text-mlm-warm-600">
                                    Use at least 8 characters, mixing letters, numbers, and symbols.
                                </p>
                            </div>

                            <app-auth-input
                                label="Sponsor Username"
                                placeholder="e.g. john_doe"
                                formControlName="sponsorUsername">
                            </app-auth-input>
                        </div>
                    }

                    <!-- Step 3: Membership -->
                    @if (currentStep() === 3) {
                        <div class="space-y-6 animate-step-in">
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-mlm-warm-800">
                                    Select package
                                </label>
                                <p class="text-xs text-mlm-warm-600">
                                    Your package defines your starting limits and earning potential. You can upgrade later.
                                </p>
                                <p-select
                                    [options]="packages"
                                    formControlName="package"
                                    optionLabel="label"
                                    placeholder="Choose your membership"
                                    styleClass="w-full !rounded-xl !border-mlm-warm-300 !shadow-none">
                                </p-select>
                                @if (registerForm.get('package')?.invalid && registerForm.get('package')?.touched) {
                                    <span class="text-xs font-medium text-mlm-error mt-1.5 block">Please select a package</span>
                                }
                            </div>

                            <div
                                class="bg-mlm-background rounded-xl p-4 border border-mlm-warm-200 flex items-start gap-3 transition-all duration-200 hover:border-mlm-primary/30">
                                <p-checkbox formControlName="acceptTerms" [binary]="true" class="mt-0.5"></p-checkbox>
                                <label class="text-sm text-mlm-warm-700 leading-relaxed">
                                    I agree to the
                                    <a href="#" class="text-mlm-primary font-semibold hover:underline">Terms &amp; Conditions</a>
                                    and confirm that I understand how the platform works.
                                </label>
                            </div>
                        </div>
                    }

                    <!-- Action Buttons -->
                    <div class="mt-8 pt-4 flex flex-col sm:flex-row items-center justify-between gap-4 border-t border-mlm-warm-100">
                        @if (currentStep() > 1) {
                            <button type="button" 
                                    (click)="prevStep()"
                                    class="px-4 py-2.5 rounded-xl text-mlm-warm-700 font-semibold hover:bg-mlm-background transition-all duration-200 text-sm w-full sm:w-auto">
                                Back
                            </button>
                        } @else {
                            <a routerLink="/auth/login" class="text-mlm-warm-600 font-semibold hover:text-mlm-primary transition-colors duration-200 text-sm w-full sm:w-auto text-center sm:text-left">
                                Already have an account?
                            </a>
                        }

                        @if (currentStep() < totalSteps()) {
                            <button type="button" 
                                    (click)="nextStep()"
                                    [disabled]="!isStepValid(currentStep())"
                                    class="px-6 py-2.5 bg-mlm-primary text-white rounded-xl font-semibold hover:bg-mlm-primary/90 transition-all duration-200 text-sm disabled:opacity-60 disabled:cursor-not-allowed w-full sm:w-auto">
                                Next Step
                            </button>
                        } @else {
                            <button type="submit" 
                                    [disabled]="!registerForm.valid || isLoading()"
                                    class="px-6 py-2.5 bg-mlm-primary text-white rounded-xl font-semibold hover:bg-mlm-primary/90 transition-all duration-200 flex items-center justify-center gap-2 text-sm disabled:opacity-60 disabled:cursor-not-allowed w-full sm:w-auto">
                                Create Account
                                @if (isLoading()) {
                                    <i class="pi pi-spin pi-spinner text-xs"></i>
                                }
                            </button>
                        }
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
