<header class="sticky top-0 z-40 flex h-16 shrink-0 items-center border-b border-gray-200 bg-white px-4 shadow-sm sm:px-6 lg:px-8">
    <!-- Mobile menu toggle -->
    <button type="button" class="-m-2.5 p-2.5 text-gray-400 lg:hidden" (click)="toggleMobileMenu()">
        <span class="sr-only">Open sidebar</span>
        <i class="pi pi-bars text-xl"></i>
    </button>

    <div class="flex flex-1 gap-x-4 self-stretch lg:gap-x-6">

        <div class="flex-1"></div>
        <div class="flex items-center gap-x-4 lg:gap-x-6">
            <!-- Notifications -->
            <button type="button"
                    class="relative -m-2.5 p-2.5 text-gray-500 hover:text-mlm-primary hover:bg-gray-50 rounded-lg transition-colors"
                    (click)="notificationsVisible.set(true)">
                <span class="sr-only">View notifications</span>
                <i class="pi pi-bell text-xl" aria-hidden="true"></i>
                @if (unreadCount() > 0) {
                    <span class="absolute top-1 right-1 min-w-5 h-5 px-1.5 flex items-center justify-center text-[10px] font-bold text-white bg-mlm-error rounded-full border-2 border-white">{{ unreadCount() }}</span>
                }
            </button>

            <p-drawer
                [visible]="notificationsVisible()"
                (visibleChange)="notificationsVisible.set($event)"
                position="right"
                [style]="{ width: '400px' }"
                styleClass="border-0 !bg-white"
                appendTo="body"
                [modal]="true"
                [dismissible]="true"
                [closeOnEscape]="true"
                [showCloseIcon]="false">
                <ng-template pTemplate="header">
                    <div class="flex flex-col w-full gap-3">
                        <div class="flex items-center justify-between gap-2">
                            <h2 class="text-base font-bold text-mlm-text">Notifications</h2>
                            @if (unreadCount() > 0) {
                                <span class="text-[10px] font-semibold text-mlm-error bg-mlm-error/10 px-2 py-1 rounded-full">{{ unreadCount() }} new</span>
                            }
                        </div>
                        <div class="flex gap-3">
                            <button type="button" (click)="markAllAsRead()" class="text-xs font-semibold text-mlm-primary hover:underline">Mark all read</button>
                            <button type="button" (click)="clearNotifications()" class="text-xs font-semibold text-mlm-secondary hover:underline">Clear</button>
                        </div>
                    </div>
                </ng-template>

                <div class="flex flex-col h-full -mx-4">
                    <div class="flex-1 overflow-y-auto px-1">
                        @for (n of notifications(); track n.id) {
                            <div class="px-4 py-5 mb-3 last:mb-0 rounded-lg border border-gray-100 hover:bg-gray-50/80 transition-colors relative"
                                 [class.bg-white]="!n.isRead"
                                 [class.border-l-4]="!n.isRead"
                                 [class.border-l-mlm-primary]="!n.isRead">
                                <div class="flex items-start justify-between gap-3">
                                    <div class="min-w-0 flex-1">
                                        <p class="text-sm font-semibold text-mlm-text">{{ n.title }}</p>
                                        <p class="text-xs text-mlm-secondary mt-0.5 leading-relaxed">{{ n.message }}</p>
                                    </div>
                                    <span class="text-[10px] font-medium text-mlm-secondary whitespace-nowrap shrink-0">{{ n.timestamp | date:'shortTime' }}</span>
                                </div>
                            </div>
                        } @empty {
                            <div class="flex flex-col items-center justify-center py-16 px-6 text-center">
                                <p class="text-sm font-semibold text-mlm-text">All caught up</p>
                                <p class="text-xs text-mlm-secondary mt-1">No new notifications at the moment.</p>
                            </div>
                        }
                    </div>

                    <div class="p-4 border-t border-gray-100 bg-white shrink-0">
                        <p-button label="View all activity" styleClass="w-full !bg-slate-900 !border-slate-900 !text-xs !font-semibold !py-2.5"></p-button>
                    </div>
                </div>
            </p-drawer>


            <!-- Separator -->
            <div class="hidden lg:block lg:h-6 lg:w-px lg:bg-gray-200" aria-hidden="true"></div>

            <!-- Profile dropdown -->
            <div class="relative">
                <button type="button" class="-m-1.5 flex items-center p-1.5" id="user-menu-button" aria-expanded="false" aria-haspopup="true" (click)="menu.toggle($event)">
                    <span class="sr-only">Open user menu</span>
                    <p-avatar 
                        [label]="currentUser()?.firstName?.charAt(0) || 'U'" 
                        shape="circle" 
                        styleClass="bg-mlm-blue-100 text-mlm-blue-600 font-bold">
                    </p-avatar>
                    <span class="hidden lg:flex lg:items-center">
                        <span class="ml-4 text-sm font-semibold leading-6 text-mlm-text" aria-hidden="true">
                            {{ currentUser()?.firstName }} {{ currentUser()?.lastName }}
                        </span>
                        <i class="pi pi-chevron-down ml-2 text-gray-400 text-xs"></i>
                    </span>
                </button>
                <p-menu #menu [model]="userMenuItems" [popup]="true" appendTo="body"></p-menu>
            </div>
        </div>
    </div>
</header>
