<div class="min-h-screen bg-mlm-background">
  <main class="py-10">
    <div class="px-4 sm:px-6 lg:px-8 mx-auto">
      <div class="space-y-8 animate-fade-in">
        <!-- Header & Filters -->
        <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm space-y-6">
          <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
            <div>
              <h1 class="text-2xl font-bold text-gray-900 mb-1">Downline List</h1>
              <p class="text-gray-500 text-sm">Manage and view your team members.</p>
            </div>
            <div class="flex gap-2">
              <p-button 
                label="Export CSV" 
                icon="pi pi-download" 
                (onClick)="exportCSV()"
                styleClass="p-button-sm">
              </p-button>
            </div>
          </div>

          <!-- Search Bar -->
          <div class="relative">
            <i class="pi pi-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
            <input 
              type="text" 
              [ngModel]="searchQuery()"
              (ngModelChange)="searchQuery.set($event)"
              placeholder="Search by username..." 
              class="w-full bg-gray-50 border border-gray-100 rounded-xl py-3 pl-11 pr-4 text-sm focus:outline-none focus:ring-2 focus:ring-mlm-primary/20 focus:border-mlm-primary/20 transition-all font-normal text-gray-900 placeholder:text-gray-400">
          </div>

          <!-- Filters: Level, Package, Status -->
          <div class="flex flex-wrap gap-4 items-center">
            <div class="flex items-center gap-2">
              <label for="filter-level" class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Level</label>
              <select 
                id="filter-level"
                [ngModel]="filterLevel()"
                (ngModelChange)="filterLevel.set($event === 'all' ? 'all' : +$event)"
                class="bg-gray-50 border border-gray-100 rounded-lg py-2 pl-3 pr-8 text-sm text-gray-900 focus:outline-none focus:ring-2 focus:ring-mlm-primary/20">
                <option value="all">All</option>
                @for (l of levelOptions(); track l) {
                  <option [value]="l">{{ l }}</option>
                }
              </select>
            </div>
            <div class="flex items-center gap-2">
              <label for="filter-package" class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Package</label>
              <select 
                id="filter-package"
                [ngModel]="filterPackage()"
                (ngModelChange)="filterPackage.set($event)"
                class="bg-gray-50 border border-gray-100 rounded-lg py-2 pl-3 pr-8 text-sm text-gray-900 focus:outline-none focus:ring-2 focus:ring-mlm-primary/20">
                <option value="all">All</option>
                <option value="Basic">Basic</option>
                <option value="Premium">Premium</option>
                <option value="VIP">VIP</option>
              </select>
            </div>
            <div class="flex items-center gap-2">
              <label for="filter-status" class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Status</label>
              <select 
                id="filter-status"
                [ngModel]="filterStatus()"
                (ngModelChange)="filterStatus.set($event)"
                class="bg-gray-50 border border-gray-100 rounded-lg py-2 pl-3 pr-8 text-sm text-gray-900 focus:outline-none focus:ring-2 focus:ring-mlm-primary/20">
                <option value="all">All</option>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Empty state: no team members (data empty) -->
        @if (!isLoading() && members().length === 0) {
          <div class="bg-white rounded-2xl border border-gray-100 p-8 shadow-sm text-center">
            <p class="text-mlm-secondary mb-6">No team members yet. Invite friends and share your referral link to grow your team.</p>
            <div class="flex flex-wrap gap-3 justify-center">
              <a routerLink="/network/referrals" class="inline-flex items-center justify-center gap-2 bg-mlm-primary text-white px-6 py-3 rounded-xl font-semibold text-sm hover:bg-mlm-primary/90 transition-colors">
                Invite Friends
              </a>
              <button type="button" (click)="copyReferralLink()" class="inline-flex items-center justify-center gap-2 bg-white border border-gray-200 text-gray-700 px-6 py-3 rounded-xl font-semibold text-sm hover:bg-gray-50 transition-colors">
                Share referral link
              </button>
            </div>
          </div>
        } @else {
        <!-- Table Section -->
        <div class="bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden">
          <p-table 
            #dt
            [value]="isLoading() ? skeletonRows : filteredMembers()" 
            [tableStyle]="{'min-width': '50rem'}"
            styleClass="p-datatable-sm"
            [rowHover]="true">
            <ng-template pTemplate="header">
              <tr>
                <th class="text-xs font-semibold uppercase tracking-wide text-gray-700">Member</th>
                <th class="text-xs font-semibold uppercase tracking-wide text-gray-700">Level</th>
                <th class="text-xs font-semibold uppercase tracking-wide text-gray-700">Package</th>
                <th class="text-xs font-semibold uppercase tracking-wide text-gray-700">Joined</th>
                <th class="text-xs font-semibold uppercase tracking-wide text-gray-700 text-center">Stats</th>
                <th class="text-xs font-semibold uppercase tracking-wide text-gray-700 text-right">Status</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-member>
              @if (isLoading()) {
                <tr>
                  <td>
                    <div class="flex flex-col gap-2">
                      <p-skeleton width="120px" height="1rem"></p-skeleton>
                      <p-skeleton width="100px" height="0.75rem"></p-skeleton>
                    </div>
                  </td>
                  <td>
                    <p-skeleton width="32px" height="32px" shape="circle" class="mx-auto"></p-skeleton>
                  </td>
                  <td>
                    <p-skeleton width="80px" height="1.5rem" borderRadius="8px"></p-skeleton>
                  </td>
                  <td>
                    <p-skeleton width="100px" height="1rem"></p-skeleton>
                  </td>
                  <td class="text-center">
                    <div class="flex gap-6 justify-center">
                      <div class="text-center">
                        <p-skeleton width="30px" height="1rem" class="mb-1"></p-skeleton>
                        <p-skeleton width="20px" height="0.625rem"></p-skeleton>
                      </div>
                      <div class="text-center">
                        <p-skeleton width="30px" height="1rem" class="mb-1"></p-skeleton>
                        <p-skeleton width="30px" height="0.625rem"></p-skeleton>
                      </div>
                    </div>
                  </td>
                  <td class="text-right">
                    <p-skeleton width="60px" height="1.5rem" borderRadius="20px" class="ml-auto"></p-skeleton>
                  </td>
                </tr>
              } @else {
                <tr class="p-selectable-row">
                  <td>
                    <div class="flex flex-col gap-1">
                      <span class="text-sm font-semibold text-gray-900 group-hover:text-mlm-primary transition-colors">{{ member.username }}</span>
                      <span class="text-xs text-gray-500">{{ member.fullName }}</span>
                    </div>
                  </td>
                  <td>
                    <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-gray-100 text-sm font-medium text-gray-700">
                      {{ member.level }}
                    </span>
                  </td>
                  <td>
                    <span [class]="'text-xs font-medium uppercase tracking-wide px-3 py-1.5 rounded-lg ' + getPackageClass(member.package)">
                      {{ member.package }}
                    </span>
                  </td>
                  <td>
                    <span class="text-sm font-normal text-gray-700">{{ member.joinDate | date:'mediumDate' }}</span>
                  </td>
                  <td class="text-center">
                    <div class="flex gap-6 text-sm">
                      <div class="text-center" title="Direct Referrals">
                        <span class="block font-semibold text-gray-900 mb-1">{{ member.totalDirects }}</span>
                        <span class="text-[10px] text-gray-500 uppercase font-medium tracking-wide">DR</span>
                      </div>
                      <div class="text-center" title="Team Size">
                        <span class="block font-semibold text-gray-900 mb-1">{{ member.teamSize }}</span>
                        <span class="text-[10px] text-gray-500 uppercase font-medium tracking-wide">Team</span>
                      </div>
                    </div>
                  </td>
                  <td class="text-right">
                    <app-status-badge [status]="member.status" size="sm" />
                  </td>
                </tr>
              }
            </ng-template>
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="6" class="py-16 text-center text-gray-500">
                  <i class="pi pi-search text-3xl mb-3 block opacity-30"></i>
                  <p class="text-sm font-medium">No members found matching "{{ searchQuery() }}"</p>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
        }
      </div>
    </div>
  </main>
</div>
