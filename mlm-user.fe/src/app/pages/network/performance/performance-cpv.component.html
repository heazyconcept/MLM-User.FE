<div class="min-h-screen bg-mlm-background">
  <main class="py-10">
    <div class="px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto">
      <div class="space-y-8 animate-fade-in">
        
        <!-- Header -->
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
          <div>
            <h1 class="text-2xl font-bold text-gray-900 mb-1">Performance & CPV</h1>
            <p class="text-gray-500 text-sm">Track your cumulative point value and rank progression.</p>
          </div>
          <div class="flex items-center gap-2 text-sm text-gray-500">
            <i class="pi pi-calendar text-xs"></i>
            <span>Cycle: <span class="font-semibold text-gray-900">{{ cpv().cycle }}</span></span>
          </div>
        </div>

        <!-- Empty state: no CPV activity -->
        @if (hasNoCpvActivity()) {
          <div class="bg-white rounded-2xl border border-gray-100 p-8 shadow-sm text-center">
            <p class="text-mlm-secondary mb-6">No CPV activity yet. Invite friends and share your referral link to start building volume.</p>
            <div class="flex flex-wrap gap-3 justify-center">
              <a routerLink="/network/referrals" class="inline-flex items-center justify-center gap-2 bg-mlm-primary text-white px-6 py-3 rounded-xl font-semibold text-sm hover:bg-mlm-primary/90 transition-colors">
                Invite Friends
              </a>
              <button type="button" (click)="copyReferralLink()" class="inline-flex items-center justify-center gap-2 bg-white border border-gray-200 text-gray-700 px-6 py-3 rounded-xl font-semibold text-sm hover:bg-gray-50 transition-colors">
                Share referral link
              </button>
            </div>
          </div>
        } @else {

        <!-- Stats Overview -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
          <!-- Personal CPV -->
          <app-stat-card
            label="Personal CPV"
            [value]="cpv().personalCpv"
            subValue="points this cycle"
            icon="pi-user"
            bgClass="bg-blue-500">
          </app-stat-card>

          <!-- Team CPV -->
          <app-stat-card
            label="Team CPV"
            [value]="cpv().teamCpv"
            [subValue]="getTeamCpvSubValue()"
            icon="pi-users"
            bgClass="bg-green-500">
          </app-stat-card>

          <!-- Current Rank -->
          <app-stat-card
            label="Current Rank"
            [value]="summary().rank"
            [subValue]="getRankSubValue()"
            icon="pi-star"
            bgClass="bg-orange-500">
          </app-stat-card>

          <!-- Progress -->
          <app-stat-card
            label="Progress"
            [value]="getProgressValue()"
            subValue="to next rank"
            icon="pi-chart-line"
            bgClass="bg-purple-500">
          </app-stat-card>
        </div>

        <!-- Earnings Contribution (visual) -->
        <div class="bg-white rounded-2xl border border-gray-100 p-6 shadow-sm">
          <h3 class="text-base font-semibold text-gray-900 mb-4">Earnings Contribution</h3>
          <p class="text-sm text-gray-500 mb-4">How your earnings break down by source (this cycle).</p>
          <div class="space-y-3">
            <div>
              <div class="flex justify-between text-xs mb-1">
                <span class="font-medium text-gray-700">From direct referrals</span>
                <span class="font-semibold text-gray-900">₦{{ earningsContribution.fromDirectReferrals | number:'1.0-0' }}</span>
              </div>
              <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
                <div class="h-full bg-mlm-primary rounded-full transition-all" [style.width.%]="getEarningsShare(earningsContribution.fromDirectReferrals)"></div>
              </div>
            </div>
            <div>
              <div class="flex justify-between text-xs mb-1">
                <span class="font-medium text-gray-700">From team volume (CPV)</span>
                <span class="font-semibold text-gray-900">₦{{ earningsContribution.fromTeamCpv | number:'1.0-0' }}</span>
              </div>
              <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
                <div class="h-full bg-green-500 rounded-full transition-all" [style.width.%]="getEarningsShare(earningsContribution.fromTeamCpv)"></div>
              </div>
            </div>
            <div>
              <div class="flex justify-between text-xs mb-1">
                <span class="font-medium text-gray-700">Personal sales</span>
                <span class="font-semibold text-gray-900">₦{{ earningsContribution.personalSales | number:'1.0-0' }}</span>
              </div>
              <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
                <div class="h-full bg-blue-500 rounded-full transition-all" [style.width.%]="getEarningsShare(earningsContribution.personalSales)"></div>
              </div>
            </div>
          </div>
          <p class="text-xs text-gray-500 mt-3">Total: ₦{{ totalEarningsContribution | number:'1.0-0' }}</p>
        </div>

        <!-- Progress Bar Section -->
        <div class="bg-white rounded-2xl border border-gray-100 p-6 shadow-sm">
          <div class="flex items-center justify-between mb-4">
            <div>
              <h3 class="text-sm font-semibold text-gray-900">Rank Progression</h3>
              <p class="text-xs text-gray-500 mt-0.5">{{ cpv().teamCpv }} / {{ cpv().requiredCpv }} CPV</p>
            </div>
            <span class="text-2xl font-bold text-mlm-primary">{{ getPercentage() | number:'1.0-0' }}%</span>
          </div>
          <div class="h-3 bg-gray-100 rounded-full overflow-hidden">
            <div 
              class="h-full bg-gradient-to-r from-mlm-primary to-green-400 rounded-full transition-all duration-1000" 
              [style.width.%]="animatedPercentage()">
            </div>
          </div>
          <div class="flex justify-between mt-3 text-xs text-gray-400">
            <span>{{ summary().rank }}</span>
            <span>{{ summary().nextRank }}</span>
          </div>
        </div>

        <!-- Bottom Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          
          <!-- Requirements Checklist -->
          <div class="bg-white rounded-2xl border border-gray-100 p-6 shadow-sm">
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-base font-semibold text-gray-900">Next Rank Requirements</h3>
              <span class="text-xs font-medium text-gray-500 bg-gray-100 px-2 py-1 rounded-full">{{ summary().nextRank }}</span>
            </div>
            
            <div class="space-y-3">
              <!-- Active Referrals - Complete -->
              <div class="flex items-center gap-4 p-4 rounded-xl bg-green-50/50 border border-green-100">
                <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center shrink-0">
                  <i class="pi pi-check text-green-600 text-sm"></i>
                </div>
                <div class="flex-1 min-w-0">
                  <p class="text-sm font-medium text-gray-900">Active Direct Referrals</p>
                  <p class="text-xs text-gray-500">{{ summary().directReferrals }} of 5 required</p>
                </div>
                <span class="text-xs font-semibold text-green-600 bg-green-100 px-2 py-1 rounded-full">Complete</span>
              </div>

              <!-- Group Volume - In Progress -->
              <div class="flex items-center gap-4 p-4 rounded-xl bg-gray-50 border border-gray-100">
                <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center shrink-0">
                  <span class="text-xs font-semibold text-gray-600">90%</span>
                </div>
                <div class="flex-1 min-w-0">
                  <p class="text-sm font-medium text-gray-900">Group Volume</p>
                  <p class="text-xs text-gray-500">{{ cpv().teamCpv }} of {{ cpv().requiredCpv }} CPV</p>
                </div>
                <span class="text-xs font-semibold text-orange-600 bg-orange-50 px-2 py-1 rounded-full">In Progress</span>
              </div>

              <!-- Maintain Active Status -->
              <div class="flex items-center gap-4 p-4 rounded-xl bg-green-50/50 border border-green-100">
                <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center shrink-0">
                  <i class="pi pi-check text-green-600 text-sm"></i>
                </div>
                <div class="flex-1 min-w-0">
                  <p class="text-sm font-medium text-gray-900">Maintain Active Status</p>
                  <p class="text-xs text-gray-500">Monthly autoship or purchase</p>
                </div>
                <span class="text-xs font-semibold text-green-600 bg-green-100 px-2 py-1 rounded-full">Complete</span>
              </div>
            </div>
          </div>

          <!-- Achievements & Milestones -->
          <div class="bg-white rounded-2xl border border-gray-100 p-6 shadow-sm">
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-base font-semibold text-gray-900">Achievements</h3>
              <button class="text-xs font-medium text-mlm-primary hover:underline">View All</button>
            </div>
            
            <div class="space-y-3">
              <!-- Achievement 1 -->
              <div class="flex items-center gap-4 p-4 rounded-xl bg-orange-50/50 border border-orange-100">
                <div class="w-10 h-10 rounded-xl bg-orange-100 flex items-center justify-center shrink-0">
                  <i class="pi pi-star-fill text-orange-500"></i>
                </div>
                <div class="flex-1 min-w-0">
                  <p class="text-sm font-medium text-gray-900">Silver Director</p>
                  <p class="text-xs text-gray-500">Achieved on Jan 5, 2026</p>
                </div>
              </div>

              <!-- Achievement 2 -->
              <div class="flex items-center gap-4 p-4 rounded-xl bg-blue-50/50 border border-blue-100">
                <div class="w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center shrink-0">
                  <i class="pi pi-users text-blue-600"></i>
                </div>
                <div class="flex-1 min-w-0">
                  <p class="text-sm font-medium text-gray-900">10 Direct Referrals</p>
                  <p class="text-xs text-gray-500">Achieved on Dec 28, 2025</p>
                </div>
              </div>

              <!-- Achievement 3 -->
              <div class="flex items-center gap-4 p-4 rounded-xl bg-green-50/50 border border-green-100">
                <div class="w-10 h-10 rounded-xl bg-green-100 flex items-center justify-center shrink-0">
                  <i class="pi pi-check-circle text-green-600"></i>
                </div>
                <div class="flex-1 min-w-0">
                  <p class="text-sm font-medium text-gray-900">First Commission</p>
                  <p class="text-xs text-gray-500">Achieved on Nov 20, 2025</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        }

      </div>
    </div>
  </main>
</div>
