<div class="min-h-screen bg-mlm-background">
  <main class="py-10">
    <div class="px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto">
      @if (order(); as o) {
        <div class="mb-6">
          <a
            routerLink="/merchant/orders"
            class="text-sm font-semibold text-mlm-primary hover:text-mlm-primary/80 inline-flex items-center gap-1 focus:outline-none focus:ring-2 focus:ring-mlm-primary/20 rounded"
            aria-label="Back to merchant orders">
            <i class="pi pi-arrow-left" aria-hidden="true"></i>
            Back to Orders
          </a>
        </div>

        <div class="bg-white rounded-lg border border-gray-100 shadow-sm p-6">
          <div class="border-b border-gray-200 pb-6 mb-6">
            <h1 class="text-2xl font-bold text-mlm-text mb-2">Order {{ o.id }}</h1>
            <p class="text-sm text-mlm-secondary mb-4">{{ formatDate(o.date) }}</p>
            <div class="flex flex-wrap items-center gap-3">
              <app-status-badge [status]="o.status" size="lg"></app-status-badge>
              <span class="text-lg font-bold text-mlm-text">{{ formatCurrency(o.total, o.currency) }}</span>
            </div>
          </div>

          <div class="border-b border-gray-200 pb-6 mb-6">
            <h2 class="text-sm font-bold text-mlm-secondary uppercase tracking-widest mb-4">Items</h2>
            <ul class="space-y-3" role="list">
              @for (item of o.items; track item.name + item.quantity) {
                <li class="flex justify-between items-start gap-4 py-3 border-b border-gray-100 last:border-0">
                  <div>
                    <span class="font-semibold text-mlm-text">{{ item.name }}</span>
                    <span class="text-sm text-mlm-secondary block">Qty: {{ item.quantity }}</span>
                  </div>
                  <span class="font-semibold text-mlm-text shrink-0">{{ formatCurrency(item.price * item.quantity, o.currency) }}</span>
                </li>
              }
            </ul>
          </div>

          <div class="border-b border-gray-200 pb-6 mb-6">
            <h2 class="text-sm font-bold text-mlm-secondary uppercase tracking-widest mb-4">Payment &amp; Fulfilment</h2>
            <dl class="space-y-3 text-sm">
              <div class="flex justify-between">
                <dt class="text-mlm-secondary">Payment method</dt>
                <dd class="font-semibold text-mlm-text">{{ o.paymentMethod ?? 'â€”' }}</dd>
              </div>
              <div class="flex justify-between">
                <dt class="text-mlm-secondary">Fulfilment</dt>
                <dd class="font-semibold text-mlm-text">{{ getFulfilmentLabel(o.fulfilmentMethod) }}</dd>
              </div>
              @if (o.fulfilmentMethod === 'delivery' && o.deliveryAddress) {
                <div>
                  <dt class="text-mlm-secondary mb-1">Delivery address</dt>
                  <dd class="font-medium text-mlm-text">{{ o.deliveryAddress }}</dd>
                </div>
                @if (o.deliveryFee != null) {
                  <div class="flex justify-between">
                    <dt class="text-mlm-secondary">Delivery fee</dt>
                    <dd class="font-semibold text-mlm-text">{{ formatCurrency(o.deliveryFee!, o.currency) }}</dd>
                  </div>
                }
              }
              @if (o.fulfilmentMethod === 'pickup' && o.pickupLocationName) {
                <div>
                  <dt class="text-mlm-secondary mb-1">Pickup location</dt>
                  <dd class="font-medium text-mlm-text">{{ o.pickupLocationName }}</dd>
                  @if (o.pickupLocationDistance) {
                    <dd class="text-mlm-secondary text-xs mt-0.5">{{ o.pickupLocationDistance }} away</dd>
                  }
                </div>
              }
            </dl>
          </div>

          <div class="border-b border-gray-200 pb-6 mb-6">
            <h2 class="text-sm font-bold text-mlm-secondary uppercase tracking-widest mb-4">Update status</h2>
            <div class="flex flex-wrap gap-3">
              <p-button
                label="Mark as Ready"
                icon="pi pi-check"
                [disabled]="!canMarkReady()"
                (onClick)="markAsReady()"
                styleClass="!bg-mlm-primary !border-mlm-primary"></p-button>
              <p-button
                label="Mark as Shipped"
                icon="pi pi-truck"
                [disabled]="!canMarkShipped()"
                (onClick)="markAsShipped()"
                severity="secondary"></p-button>
              <p-button
                label="Mark as Completed"
                icon="pi pi-check-circle"
                [disabled]="!canMarkCompleted()"
                (onClick)="markAsCompleted()"
                severity="success"></p-button>
            </div>
          </div>

          <div class="pb-6">
            <h2 class="text-sm font-bold text-mlm-secondary uppercase tracking-widest mb-4">Order timeline</h2>
            <app-order-timeline [currentStatus]="o.status"></app-order-timeline>
          </div>
        </div>
      }
    </div>
  </main>
</div>
